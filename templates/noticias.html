{% extends "base.html" %}
{% block head %}
{{ super() }}
        <link href="/static/assets/global/plugins/bootstrap-select/css/bootstrap-select.min.css" rel="stylesheet" type="text/css" />
        <link href="/static/assets/global/plugins/jquery-multi-select/css/multi-select.css" rel="stylesheet" type="text/css" />
        <link href="/static/assets/global/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
        <link href="/static/assets/global/plugins/select2/css/select2-bootstrap.min.css" rel="stylesheet" type="text/css" />

{% endblock %}

{% block headtabs %}
      <li class="dropdown dropdown-fw active selected">
                         <a href="{{ url_for('index') }}" class="text-uppercase">
                         <i class="fa fa-globe"></i> S&H </a>
                         <ul class="dropdown-menu dropdown-menu-fw">
                         </ul>
                    </li>
      <li class="dropdown dropdown-fw  active open selected">
             <a href="javascript:;" class="text-uppercase">
                  <i class="fa fa-cubes"></i> Rankings </a>
                  <ul class="dropdown-menu dropdown-menu-fw">
                      <li>
                          <a href="{{url_for('ranking')}}">
                            <button class=" btn btn-default">
                              <i class="icon-list"></i> Ranking Combinado 
                          </button></a>
                      </li>
                      <li>
                          <a href="{{url_for('score')}}">
                            <button class=" btn btn-default">
                              <i class="icon-list"></i> Ranking Social 
                              </button></a>
                      </li>
                      <li class="active">
                          <a href="{{url_for('noticias')}}">
                            <button class=" btn btn-default active">
                              <i class="icon-list"></i> Ranking Noticias 
                          </button></a>
                      </li>
                      <!--
                      <li>
                      <a href="dashboard_3.html">
                      <i class="icon-pie-chart"></i> Dashboard 3 </a>
                      </li>
                      <li>
                      <a href="dashboard_3.html">
                      <i class="icon-bar-chart"></i> Dashboard 3 </a>
                      </li>
                      -->
                 </ul>
        </li>
        <li class="dropdown dropdown-fw active selected">
             <a href="/ppublicas" class="text-uppercase">
             <i class="fa fa-university"></i> Politicas Pub </a>
             <ul class="dropdown-menu dropdown-menu-fw">
             </ul>
        </li>
         <li class="dropdown dropdown-fw active selected">
             <a href="/corrs" class="text-uppercase">
             <i class="fa fa-th"></i> Correlaciones </a>
             <ul class="dropdown-menu dropdown-menu-fw">
             </ul>
        </li>
        <li class="dropdown        dropdown-fw active selected">
             <a href="/reportes" class="text-uppercase">
                 <i class="fa fa-download"></i> Reportes </a>
             <ul class="dropdown-menu dropdown-menu-fw">
             </ul>
        </li>
       <li class="dropdown dropdown-fw active selected">
             <a href="/usuarios" class="text-uppercase">
                 <i class="fa fa-users"></i> Usuarios </a>
             <ul class="dropdown-menu dropdown-menu-fw">
             </ul>
        </li>

{% endblock%}



{% block content %}
<div class="page-content">
		<!-- BEGIN SELECTOR -->
		<h3>
			Índice de Desempeño en Noticias Nacionales
		</h3>
    <p>
    El siguiente análisis muestra el desempeño social por entidad federativa durante el periodo <b>{{ sdate }}</b> a <b>{{ ndate }}</b>
    en la categoria: <b>{{ topic | capitalize() }}</b>.
    En esta sección el visitante tiene la opción de seleccionar las categorías:
    <br/>Presidente de la República, Gobernador del Estado, Diputados y
  Senadores, Servicios, Seguridad, Economía, Obra Pública, y Gobierno en general. Analizados únicamente en los medios noticiosos del país.
  <br/>

    </p>
		<div class="row">
		<!-- BEGIN STATES SELECTOR -->
					<!--<div class="col-md-3">
                                            <label for="select1-single-input-sm" class="control-label">Estado</label>
                                            <select id="select1-single-input-sm" class="form-control input-sm select2-multiple select2-hidden-accessible" tabindex="-1" aria-hidden="true">
                                                <optgroup label="">
                                                    <option value="">Seleccione una opcion</option>
                                                </optgroup>
                                                <optgroup label="Estados">
						    {% for tuple in estados %}
                                                    <option value="{{ tuple[0] }}">{{ tuple[1] }}</option>
                                               	    {% endfor %}
						 </optgroup>
                                            </select>
                                        </div>-->
		<!-- END STATES SELECTOR -->
		<!-- BEGIN CATEGORY SELECTOR -->
					<div class="col-md-3">
                                            <label for="select2-single-input-sm" class="control-label">Categoria</label>
                                            <select id="select2-single-input-sm" class="form-control input-sm select2-multiple select2-hidden-accessible" tabindex="-1" aria-hidden="true">
                                                <optgroup label="">
                                                    <option value="">Seleccione una opcion</option>
                                                </optgroup>
                                                <optgroup label="Categorias">
						    {% for item in temas %}
                                                    <option value="{{ item }}">{{ item|capitalize() }}</option>
                                               	    {% endfor %}
						 </optgroup>
                                            </select>
                                        </div>
		<!-- END CATEGORY SELECTOR -->
		<br/>
		<button id="search-button" class="btn btn-circle green btn-sm" type="button">
		Buscar</button>
		</div>
		<br/>
		<!-- END SELECTORS -->

		<!-- BEGIN STACK CHART CONTROLS PORTLET-->
		<div class="row">
		<div class="col-md-12">

      <!-- BEGIN EXAMPLE TABLE PORTLET-->
      <div class="portlet light bordered">
          <div class="portlet-title">
              <div class="caption font-dark">
                  <i class="icon-list font-dark"></i>
                  <span class="caption-subject bold uppercase">Estados que conforman el Índice</span>
              </div>
              <a href="/export/rnoticias" target="_blank">
                  <button class="btn btn-circle blue btn-sm" type="button" style="float:right">
                  Exportar datos
              </button></a>
          </div>
          <div class="portlet-body">
              <div class="table-toolbar">
                  <div class="row">
                      <div class="col-md-6">
                      </div>
                      <div class="col-md-6">
                      </div>
                  </div>
              </div>
              <table class="table table-striped table-bordered table-hover table-checkable order-column" id="sample">
                  <thead>
                       <tr>
                          <th> Estado </th>
                          <th> Ranking Semana Actual </th>
                          <th> Score Semana Actual </th>
                           <th> Ranking Semana Anterior </th>
                          <th> Score Semana Anterior </th>
                            <th> Cambio Ranking </th>
                          <th> Cambio Score </th>
                       </tr>
                  </thead>
                  <tbody>
                       {% for i in xrange(len(rank_data)) %}
                           <tr class="odd gradeX">
                               <td class="span6" style="max-width:1000px"> {{ rank_data[i][0] }} </td>
                               <td>
                               {{ rank_data[i][1] }}
                               </td>
                               <td> {{ rank_data[i][2] }} </td>
                                <td>
                               {{ last_rank_data[i][1] }}
                               </td>
                               <td> {{ last_rank_data[i][2] }} </td>
 
                               <td>
                               {% if
             last_rank_data[i][1]-rank_data[i][1] > 0
                               %}
                       <i class="fa fa-chevron-up" style="color:green"></i>
                       {% else %}
                       <i class="fa fa-chevron-down" style="color:red"></i>
                       {% endif %}&nbsp;&nbsp;
                       {{
               last_rank_data[i][1]-rank_data[i][1]
                       }}
                       </td>
                       <td>
                       {% if
              int(((rank_data[i][2]-last_rank_data[i][2])/last_rank_data[i][2])*100)>0
                       %}
                       <i class="fa fa-chevron-up" style="color:green"></i>
                       {% else %}
                       <i class="fa fa-chevron-down" style="color:red"></i>
                       {% endif %}&nbsp;&nbsp;
                       {{
              int(((rank_data[i][2]-last_rank_data[i][2])/last_rank_data[i][2])*100)
                       }}%
                       </td>
 </tr>
                        {% endfor %}
                  </tbody>
             </table>
          </div>

      <div class="row">
        <div id="timeline-container" style="height: 400px; min-width: 310px">
        </div>
      </div>

      </div>
      <!-- END EXAMPLE TABLE PORTLET-->
      <b>Notas:</b><br/> 
      1. La categoría “Servicios” incluye: salud, recolección de basura, servicio de agua y transporte público.
      <br/>2. La categoría “Obra Pública” incluye: Pavimentación y construcción de obras públicas en general
      <br/>3. La categoría “Gobierno” incluye: frases o menciones en donde se incluye la palabra “Gobierno”
      <hr><br/>
      Para conocer más acerca de la metodología, favor de visitar la página:.
            <a href="http://www.gcn-p.com/metodologia/">http://www.gcn-p.com/metodologia/</a>
    </div>
		<!-- END STACK CHART CONTROLS PORTLET-->	
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
	<!-- BEGIN PAGE LEVEL PLUGINS -->
        <script src="/static/assets/global/scripts/datatable.js" type="text/javascript"></script>
        <script src="/static/assets/global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
        <script src="/static/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
        <script src="/static/assets/global/plugins/flot/jquery.flot.min.js" type="text/javascript"></script>
        <script src="/static/assets/global/plugins/flot/jquery.flot.resize.min.js" type="text/javascript"></script>
        <script src="/static/assets/global/plugins/flot/jquery.flot.categories.min.js" type="text/javascript"></script>
        <script src="/static/assets/global/plugins/flot/jquery.flot.pie.min.js" type="text/javascript"></script>
        <script src="/static/assets/global/plugins/flot/jquery.flot.stack.min.js" type="text/javascript"></script>
        <script src="/static/assets/global/plugins/flot/jquery.flot.crosshair.min.js" type="text/javascript"></script>
        <script src="/static/assets/global/plugins/flot/jquery.flot.categories.min.js" type="text/javascript"></script>
        <script src="/static/assets/global/plugins/bootstrap-select/js/bootstrap-select.min.js" type="text/javascript"></script>
        <script src="/static/assets/global/plugins/jquery-multi-select/js/jquery.multi-select.js" type="text/javascript"></script>
        <script src="/static/assets/global/plugins/select2/js/select2.full.min.js" type="text/javascript"></script>
  <!-- END PAGE LEVEL PLUGINS -->
        <!-- BEGIN PAGE LEVEL SCRIPTS -->
	<!--<script src="static/assets/pages/scripts/charts-flotcharts.min.js" type="text/javascript"/>-->
	<script src="/static/assets/pages/scripts/timeline.js" type="text/javascript"></script>
        <script type="text/javascript">
    	//var topics = [{% for topic in tpars %}"{{topic}}",{% endfor %}];

	</script>
	<script src="/static/assets/pages/scripts/components-select2.js" type="text/javascript"></script>
	<!-- END PAGE LEVEL SCRIPTS -->
	<script>
	jQuery(document).ready(function() {
        	$("#search-button").on("click",function(){
			var estado = $("#select1-single-input-sm").val();
			var tema = $("#select2-single-input-sm").val();
			window.location.href = '/noticias/'+tema+'-'+estado;
		  });
      $('#sample').dataTable({
          "order": [[ 0, "asc" ]],
          "lengthMenu": [[-1], ["All"]]
      });
   });
	</script>


  <script type="text/javascript">
      var TableDatatablesManaged = function() {
      var e = function(topic) {
          var e = $("#sample_"+topic);
          e.dataTable({
             language: {
             aria: {
                sortAscending: ": activate to sort column ascending",
                sortDescending: ": activate to sort column descending"
             },
             emptyTable: "No data available in table",
                info: "Showing _START_ to _END_ of _TOTAL_ records",
                infoEmpty: "No records found",
                infoFiltered: "(filtered1 from _MAX_ total records)",
                lengthMenu: "Show _MENU_",
                search: "Search:",
                zeroRecords: "No matching records found",
                paginate: {
                   previous: "Prev",
                   next: "Next",
                   last: "Last",
                   first: "First"
                }
             },
             bStateSave: !0,
             columnDefs: [{
                targets: 0,
                orderable: !1,
                searchable: !1
             }],
             lengthMenu: [
                [5, 15, 20, -1],
                [5, 15, 20, "All"]
             ],
             pageLength: 5,
             pagingType: "bootstrap_full_number",
             columnDefs: [{
                orderable: !1,
                targets: [0]
             }, {
                searchable: !1,
                targets: [0]
             }],
             order: [
                [1, "asc"]
             ]
             });
             jQuery("#sample_"+topic+"_wrapper");
             e.find(".group-checkable").change(function() {
                var e = jQuery(this).attr("data-set"),
                t = jQuery(this).is(":checked");
                jQuery(e).each(function() {
                    t ? ($(this).attr("checked", !0), $(this).parents("tr").addClass("active")) : ($(this).attr("checked", !1), $(this).parents("tr").removeClass("active"))
                }), jQuery.uniform.update(e)
                }), e.on("change", "tbody tr .checkboxes", function() {
                    $(this).parents("tr").toggleClass("active")
                })
           }
          //    };
    //return {
    //    init: function() {
    var topics = [{% for topic in rsearch %}"{{topic}}",{% endfor %}];
        jQuery().dataTable;
            for(topic in topics){
              if (topics[topic] != "")
                jQuery().dataTable    && (e(topics[topic]))
                      }
    //    }
    //}
    //}
};
App.isAngularJsApp() === !1 && jQuery(document).ready(function() {
      TableDatatablesManaged();
});
  </script>


  <script src="https://code.highcharts.com/stock/highstock.js"></script>
  <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>

  <script>
<!-- Timeline Extended Script -->

    function createChart() {

       $('#timeline-container').highcharts('StockChart', {

          rangeSelector: {
             selected: 1
          },

          yAxis: {
             labels: {
             formatter: function () {
                 return (this.value > 0 ? ' + ' : '') + this.value + '%';
             }
             },
             plotLines: [{
               value: 0,
               width: 2,
               color: 'silver'
             }]
         },

         plotOptions: {
             series: {
               compare: 'percent'
             }
         },

         tooltip: {
           pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',
           valueDecimals: 2
         },

         series: seriesOptions
       });
   }

   var names = [
     {% for code in estados %}
       "{{ code[0] }}",
     {% endfor %}
   ];

   var seriesOptions = [];
   var seriesCounter = 0 ;
   $.each(names, function (i, name) {

      $.getJSON('/api/score/states/'+name+'/{{ topic }}',    function (data) {
            seriesOptions[i] = {
               name: name,
               data: data
            };
            // As we're loading the data assetsynchronously, we don't know what order it will arrive. So
            // we keep a counter and create the chart when all the data is loaded.
            seriesCounter += 1;

            if (seriesCounter === names.length) {
                createChart();
            }
      });
   });
</script>




















{% endblock %}

